<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>heaparray.hpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#pragma once

/*
* This file contains a class that represents a heap allocated fixed-sized array, that is aligned to a specified value.
* This class is meant to be used as a indirect replacement for std::vector, when the size of the container wont change.
* Elements are not initialized by default.
*/

#include "aliases.hpp"

template&lt;typename T, size_t Align = sizeof(T)&gt;
class HeapArray {
    static_assert(Align &gt;= std::hardware_destructive_interference_size, "Alignment cannot be lesser than a single cache line size.");
    static_assert(Align % sizeof(T) == 0, "Alignment must be multiply of element size.");
    static_assert(std::has_single_bit(Align), "Alignment must be power of two.");

public:
    [[nodiscard]] constexpr explicit HeapArray() noexcept 
<span style = "background-color:#dfd">        : data_(nullptr), size_(0) {}</span>
    [[nodiscard]] constexpr explicit HeapArray(const size_t size) noexcept
<span style = "background-color:#dfd">        : data_(static_cast&lt;T*&gt;(_aligned_malloc(sizeof(T)* size, Align))), size_(size) {}
    constexpr ~HeapArray() noexcept {
        if (data_ != nullptr) {
            _aligned_free(data_);
            data_ = nullptr;</span>
        }
<span style = "background-color:#dfd">    }</span>

    [[nodiscard]] constexpr explicit HeapArray(const HeapArray&amp;) = delete;
    constexpr HeapArray&amp; operator=(const HeapArray&amp;) = delete;
    [[nodiscard]] constexpr HeapArray(HeapArray&amp;&amp; other) noexcept {
        this-&gt;~HeapArray();
        data_ = other.data_;
        size_ = other.size_;
        other.data_ = nullptr;
        other.size_ = 0;
    }
<span style = "background-color:#dfd">    constexpr HeapArray&amp; operator=(HeapArray&amp;&amp; other) noexcept {
        this-&gt;~HeapArray();
        data_ = other.data_;
        size_ = other.size_;
        other.data_ = nullptr;
        other.size_ = 0;
        return *this;
    }</span>

<span style = "background-color:#dfd">    [[nodiscard]] constexpr const T&amp; operator[](const size_t index) const noexcept {
        return data_[index];
    }</span>

<span style = "background-color:#dfd">    [[nodiscard]] constexpr T&amp; operator[](const size_t index) noexcept {
        return data_[index];
    }</span>

<span style = "background-color:#dfd">    [[nodiscard]] constexpr std::span&lt;T&gt; buffer() noexcept {
        return std::span&lt;T&gt;(data_, size_);
    }</span>

<span style = "background-color:#dfd">    [[nodiscard]] constexpr const_span&lt;T&gt; view() const noexcept {
        return const_span&lt;T&gt;(data_, size_);
    }</span>

    [[nodiscard]] constexpr std::span&lt;T&gt; buffer(const size_t offset, const size_t size) noexcept {
        return std::span&lt;T&gt;(data_ + offset, size);
    }

    [[nodiscard]] constexpr std::span&lt;T&gt; view(const size_t offset, const size_t size) const noexcept {
        return const_span&lt;T&gt;(data_ + offset, size);
    }
private:
    T* data_;
    size_t size_;
};</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>