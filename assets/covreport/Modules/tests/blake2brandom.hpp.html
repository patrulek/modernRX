<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>blake2brandom.hpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#pragma once

/*
* Blake2b pseudo random number generator: https://github.com/tevador/RandomX/blob/master/doc/specs.md#35-blakegenerator
* This is used for RandomX superscalar program generation.
*/

#include "blake2b.hpp"

namespace modernRX::blake2b {
    // Holds generator's current state (which is 64-bytes blake2b hash) and allows to get 8- or 32-bit values.
    class alignas(64) Random {
    public:
        // Calculates blake2b hash from given seed and nonce and set it as a current state.
        // Seed max size is 60 bytes (bigger buffers will be truncated).
        [[nodiscard]] explicit Random(const_span&lt;std::byte&gt; seed, const uint32_t nonce = 0) noexcept;

        // Return 8-bit unsigned int. Rehashes state if no bytes available. 
        [[nodiscard]] uint8_t getUint8() noexcept;

        // Return 32-bit unsigned int. Rehashes state if less than 4 bytes available.
        [[nodiscard]] uint32_t getUint32() noexcept;
    private:
        // Generates new state (blake2b hash) if left less bytes than needed.
        void rehashIfNeeded(const size_t bytes_needed) noexcept;

        std::array&lt;std::byte, Max_Digest_Size&gt; state{};
<span style = "background-color:#dfd">        uint32_t position{ 0 };</span>
    };
}</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>