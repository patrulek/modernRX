<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>alignedallocator.hpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#pragma once

/*
* Aligned allocator for STL containers. Uses msvc-specific functions.
* Not a part of RandomX algorithm.
*/

#include &lt;bit&gt;
#include &lt;utility&gt;

template&lt;typename T, size_t Alignment = 4096&gt;
struct AlignedAllocator {
public:
    static_assert(Alignment &gt;= sizeof(T), "Alignment must be greater than or equal to sizeof(T)");
    static_assert(std::has_single_bit(Alignment), "Alignment must be a power of 2");

    using value_type = T;
    /**
     * This is only necessary because AlignedAllocator has a second template
     * argument for the alignment that will make the default
     * std::allocator_traits implementation fail during compilation.
     * @see https://stackoverflow.com/a/48062758/2191065
     */
    template&lt;class OtherElementType&gt;
    struct rebind
    {
        using other = AlignedAllocator&lt;OtherElementType, std::max&lt;size_t&gt;(sizeof(OtherElementType), Alignment)&gt;;
    };

    constexpr AlignedAllocator() noexcept = default;

    template&lt;typename U&gt;
<span style = "background-color:#dfd">    constexpr AlignedAllocator(const AlignedAllocator&lt;U, std::max&lt;size_t&gt;(sizeof(U), Alignment)&gt;&amp;) noexcept {}</span>

<span style = "background-color:#dfd">    [[nodiscard]] T* allocate(std::size_t size) {
        return static_cast&lt;T*&gt;(_aligned_malloc(sizeof(T) * size, Alignment));
    }</span>

<span style = "background-color:#dfd">    void deallocate(T* data, [[maybe_unused]] std::size_t size_bytes) {
        _aligned_free(data);
    }</span>
};</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>